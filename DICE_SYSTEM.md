# 🎲 骰子判定系统使用指南

## 概述

AI说书人现在支持TRPG风格的骰子判定机制！在特殊场景（战斗、谈判、冒险等）中，某些选项需要通过投掷骰子来决定成功或失败。

## 核心机制

### 2D6系统
- 投掷两个6面骰子，结果范围：2-12
- 平均值：7
- 双6（12）：自动大成功 🌟
- 双1（2）：自动大失败 💀

### 特质加成
角色的特质会影响判定结果：
- 每个匹配的特质提供 +2 到 +4 的加成
- 例如：攻击动作匹配"勇敢"特质，可能获得+3加成

### 判定结果
| 最终结果 vs 难度 | 结果等级 | 图标 | 说明 |
|-----------------|---------|------|------|
| 超出6+或双6 | 大成功 | 🌟 | 超出预期的完美表现 |
| 超出4-5 | 完美成功 | ⭐ | 非常顺利，略有惊喜 |
| 达到或超出 | 成功 | ✓ | 达成基本目标 |
| 低于难度 | 失败 | ❌ | 未能达成目标 |
| 低于6+或双1 | 大失败 | 💀 | 不仅失败，还有额外麻烦 |

## 难度等级

| 难度值 | 等级 | 成功率（无加成） | 适用场景 |
|-------|------|----------------|---------|
| 6 | 简单 | 83% | 基础动作 |
| 8 | 普通 | 58% | 常规挑战 |
| 10 | 困难 | 28% | 高风险行动 |
| 11-12 | 极难 | 8-3% | 几乎不可能 |

## 使用示例

### 武侠战斗场景
```
剧情：三名黑衣人向你冲来，刀光闪烁！

选项1：硬接一招，以攻对攻 🎲
  难度：9
  相关特质：勇敢（+3）
  
选项2：闪身躲避，寻找破绽 🎲
  难度：7
  相关特质：冷静（+2）、谨慎（+2）

选项3：虚晃一招，趁机逃跑
  无需判定
```

### 黑帮谈判场景
```
剧情：对面老大眼神冰冷："给我个不杀你的理由。"

选项1：威胁他，暗示你有后手 🎲
  难度：10
  相关特质：狡猾（+4）、勇敢（+2）
  
选项2：展示价值，提出合作 🎲
  难度：8
  相关特质：智慧（+3）、魅力（+3）

选项3：立即求饶
  无需判定，但可能有其他后果...
```

## 判定流程

1. **选择需要判定的选项**
   - 带有 🎲 图标的选项需要骰子判定
   - 显示难度等级（简单/普通/困难/极难）

2. **骰子滚动动画**
   - 两个骰子依次出现并滚动
   - 动画时长约1秒

3. **查看判定结果**
   - 显示两个骰子的点数
   - 显示特质加成（如果有）
   - 显示最终结果和判定等级

4. **继续剧情**
   - AI根据判定结果生成相应剧情
   - 大成功会有额外奖励
   - 大失败会带来额外麻烦

## AI自动识别

AI会自动识别以下类型的动作，并标记为需要判定：

### 战斗场景
- 攻击、防御、闪避、格挡、反击

### 社交场景
- 说服、威胁、欺骗、谈判、诱惑

### 技能场景
- 潜行、侦查、破解、追踪、躲藏

### 危险场景
- 跳跃、攀爬、逃跑、冒险行动

## 策略建议

### 1. 选择匹配的特质
创建角色时，根据你的游戏风格选择特质：
- **战斗流**：勇敢、冷静
- **潜行流**：谨慎、狡猾
- **社交流**：魅力、智慧

### 2. 评估风险与回报
- 高难度选项通常有更好的结果
- 但失败的代价也更大
- 考虑你的特质加成再做决定

### 3. 保留安全选项
- 不是所有选项都需要判定
- 安全选项可能回报较低，但稳定

## 特殊情况

### 双6双骰
- 无论难度多高，都是大成功
- AI会生成特别精彩的剧情

### 双1双骰
- 无论加成多少，都是大失败
- 即使是简单任务也可能搞砸

### 超高加成
- 如果你的特质完美匹配，可能获得+6以上加成
- 几乎保证成功，除非运气极差

## 历史记录

所有的骰子判定都会保存在历史记录中：
- 查看每次判定的详细结果
- 回顾你的幸运时刻和失败经历
- 分析哪些特质最有用

## 开发者信息

### 数据结构
```typescript
interface DiceRoll {
  dice1: number;      // 第一个骰子 (1-6)
  dice2: number;      // 第二个骰子 (1-6)
  total: number;      // 两骰子之和
  bonus: number;      // 特质加成
  finalResult: number; // 总和 + 加成
  difficulty: number;  // 难度值
  outcome: DiceOutcome; // 结果等级
  matchedTraits: string[]; // 触发加成的特质
}
```

### 扩展建议
- 可以添加更多骰子类型（D20, D100）
- 可以实现"优势/劣势"机制
- 可以添加"运气点"系统允许重投

---

**享受你的冒险，愿骰子之神眷顾你！** 🎲✨

